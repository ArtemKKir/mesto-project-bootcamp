(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"];function t(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var n=function(e,t,n){var c=n.inputErrorClass,i=n.errorClass,l=e.querySelector(".".concat(t.id,"_error"));t.validity.valid?r(e,t,l,c,i):o(e,t,l,c,i,t.validationMessage)},o=function(e,t,n,o,r,c){t.classList.add(o),n.classList.add(r),n.textContent=c},r=function(e,t,n,o,r){t.classList.remove(o),n.classList.remove(r),n.textContent=""},c=function(e,t,n){i(e)?u(t,n):l(t,n)},i=function(e){return e.some((function(e){return!e.validity.valid}))},l=function(e,t){e.classList.remove(t),e.disabled=!1},u=function(e,t){e.classList.add(t),e.disabled=!0},a=document.querySelector("#element-template").content.querySelector(".element"),s=document.querySelector(".elements"),d=document.querySelector(".profile__info"),f=document.querySelector(".popup_picture"),m=f.querySelector(".popup__image"),_=f.querySelector(".popup__caption"),p=(document.querySelector(".popup"),document.querySelector(".profile-popup")),y=document.querySelector(".popup_place"),v=y.querySelector(".form_place"),h=document.querySelector(".popup_picture__close-btn"),S=document.querySelector(".profile__image_edit"),b=document.querySelector(".ave-popup"),q=document.querySelector(".form_ave"),k=document.querySelector(".input-url_ave"),L=document.querySelector(".profile__image"),g=document.querySelector(".form__submit-btn_ave"),E=document.querySelector(".form__submit-btn_place"),C=document.querySelector(".form__submit-btn_profile"),x=document.querySelector(".profile__edit-btn"),O=document.querySelector(".popup__close-btn_profile"),U=document.querySelector(".profile__add-btn"),j=document.querySelector(".popup_place__close-btn"),P=document.querySelector(".popup__close-btn_ave"),T=document.querySelector(".body"),A=y.querySelector(".input-place"),N=y.querySelector(".input-url"),w=document.querySelector(".form_profile"),B=w.querySelector(".name-input"),D=w.querySelector(".job-input"),J=document.querySelector(".profile__title"),H=document.querySelector(".profile__subtitle"),z={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-4",headers:{Authorization:"e14450da-01ef-426a-8180-a1ba601a97ba","Content-Type":"application/json"}};function I(e){e.classList.add("popup_opened"),T.addEventListener("keydown",F)}function M(e){e.classList.remove("popup_opened"),T.removeEventListener("keydown",F)}function F(e){"Escape"===e.key&&M(document.querySelector(".popup_opened"))}function G(e){g.textContent=e?"Сохранение...":"Сохранить"}function K(e){C.textContent=e?"Сохранение...":"Сохранить"}function Q(e){E.textContent=e?"Сохранение...":"Создать"}var R,V,W,X=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},Y=function(){return fetch("".concat(z.baseUrl,"/cards"),{headers:z.headers}).then(X)},Z=(Y(),function(e){s.prepend($(e))}),$=function(e){var t=a.cloneNode(!0);t.querySelector(".element__name").textContent=e.name,t.querySelector(".element__like_count").textContent=e.likes.length;var n=e._id,o=e.owner._id,r=e.likes,c=t.querySelector(".element__like-btn");o!==d.id&&t.querySelector(".element__dlt-btn").classList.add("element__dlt-btn_hidden"),t.querySelector(".element__dlt-btn").addEventListener("click",(function(){var e;(e=n,fetch("".concat(z.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:z.headers,body:JSON.stringify({_id:""})}).then(X)).then((function(){return t.remove()})).catch((function(e){console.log(e)}))})),r.forEach((function(e){e._id===d.id&&c.classList.add("element__like-btn_active")})),t.querySelector(".element__like-btn").addEventListener("click",(function(e){var o;e.target.classList.contains("element__like-btn_active")?(o=n,fetch("".concat(z.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:z.headers,body:JSON.stringify({_id:""})}).then(X).catch((function(e){console.log(e)}))).then((function(e){t.querySelector(".element__like_count").textContent=e.likes.length})).then((function(){return e.target.classList.remove("element__like-btn_active")})):e.target.classList.contains("element__like-btn_active")||function(e){return fetch("".concat(z.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:z.headers,body:JSON.stringify({_id:""})}).then(X).catch((function(e){console.log(e)}))}(n).then((function(e){t.querySelector(".element__like_count").textContent=e.likes.length})).then((function(){return e.target.classList.add("element__like-btn_active")}))}));var i=t.querySelector(".element__image");return i.src=e.link,i.alt="Изображение ".concat(e.name),i.addEventListener("click",(function(){m.src=e.link,m.alt="Изображение ".concat(e.name),_.textContent=e.name,I(f)})),console.log(d.id),console.log(r.length),console.log(t.querySelector(".element__like_count").textContent),t};Promise.all([fetch("".concat(z.baseUrl,"/users/me"),{headers:z.headers}).then(X),Y()]).then((function(e){J.textContent=e[0].name,H.textContent=e[0].about,L.src=e[0].avatar,d.id=e[0]._id,e[1].reverse().forEach((function(e){return Z(e)}))})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){I(b),q.reset()})),P.addEventListener("click",(function(){M(b)})),j.addEventListener("click",(function(){M(y)})),h.addEventListener("click",(function(){M(f)})),q.addEventListener("submit",(function(e){e.preventDefault(),G(!0),fetch("".concat(z.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:z.headers,body:JSON.stringify({avatar:k.value})}).then(X).then((function(e){L.src=k.value,M(b)})).catch((function(e){console.log(e)})).finally((function(e){G(!1)}))})),U.addEventListener("click",(function(){I(y),v.reset()})),v.addEventListener("submit",(function(e){e.preventDefault(),Q(!0),A.value,N.value,fetch("".concat(z.baseUrl,"/cards"),{method:"POST",headers:z.headers,body:JSON.stringify({name:A.value,link:N.value})}).then(X).then((function(e){Z(e)})).catch((function(e){console.log(e)})).finally((function(e){Q(!1)})),M(y)})),x.addEventListener("click",(function(){I(p),B.value=J.textContent,D.value=H.textContent})),O.addEventListener("click",(function(){M(p)})),w.addEventListener("submit",(function(e){e.preventDefault,K(!0),fetch("".concat(z.baseUrl,"/users/me"),{method:"PATCH",headers:z.headers,body:JSON.stringify({name:B.value,about:D.value})}).then(X).then((function(e){J.textContent=B.value,H.textContent=D.value,M(p)})).catch((function(e){console.log(e)})).finally((function(e){K(!1)}))})),T.addEventListener("click",(function(e){e.target.classList.contains("popup_opened")&&M(document.querySelector(".popup_opened"))})),V=(R={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__submit-btn",inactiveButtonClass:"form__submit-btn_disabled",inputErrorClass:"form__item_error",errorClass:"form__error"}).formSelector,W=t(R,["formSelector"]),Array.from(document.querySelectorAll(V)).forEach((function(o){o.addEventListener("submit",(function(e){e.preventDefault()})),function(o,r){var i=r.inputSelector,l=r.submitButtonSelector,a=r.inactiveButtonClass,s=t(r,e),d=Array.from(o.querySelectorAll(i)),f=o.querySelector(l);o.addEventListener("reset",(function(){setTimeout((function(){u(f,a)}),0)})),d.forEach((function(e){e.addEventListener("input",(function(){n(o,e,s),c(d,f,a)}))}))}(o,W)}))})();