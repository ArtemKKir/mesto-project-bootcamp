(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{sJ:()=>W,v_:()=>ee,xz:()=>$});var t=["inputSelector","submitButtonSelector","inactiveButtonClass"];function n(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=function(e,t,n){var o=n.inputErrorClass,i=n.errorClass,l=e.querySelector(".".concat(t.id,"_error"));t.validity.valid?c(e,t,l,o,i):r(e,t,l,o,i,t.validationMessage)},r=function(e,t,n,o,r,c){t.classList.add(o),n.classList.add(r),n.textContent=c},c=function(e,t,n,o,r){t.classList.remove(o),n.classList.remove(r),n.textContent=""},i=function(e,t,n){l(e)?a(t,n):u(t,n)},l=function(e){return e.some((function(e){return!e.validity.valid}))},u=function(e,t){e.classList.remove(t),e.disabled=!1},a=function(e,t){e.classList.add(t),e.disabled=!0},s=document.querySelector("#element-template").content.querySelector(".element"),d=document.querySelector(".elements"),f=document.querySelector(".profile__info"),m=document.querySelector(".popup_picture"),p=m.querySelector(".popup__image"),_=m.querySelector(".popup__caption"),v=(document.querySelector(".popup"),document.querySelector(".profile-popup")),y=document.querySelector(".popup_place"),h=y.querySelector(".form_place"),b=document.querySelector(".popup_picture__close-btn"),S=document.querySelector(".profile__image_edit"),q=document.querySelector(".ave-popup"),g=document.querySelector(".form_ave"),L=document.querySelector(".input-url_ave"),k=document.querySelector(".profile__image"),E=document.querySelector(".form__submit-btn"),C=document.querySelector(".profile__edit-btn"),O=document.querySelector(".popup__close-btn_profile"),x=document.querySelector(".profile__add-btn"),j=document.querySelector(".popup_place__close-btn"),P=document.querySelector(".popup__close-btn_ave"),U=document.querySelector(".body"),T=y.querySelector(".input-place"),w=y.querySelector(".input-url"),A=document.querySelector(".form_profile"),J=A.querySelector(".name-input"),N=A.querySelector(".job-input"),B=document.querySelector(".profile__title"),D=document.querySelector(".profile__subtitle"),z={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-4",headers:{Authorization:"e14450da-01ef-426a-8180-a1ba601a97ba","Content-Type":"application/json"}};function H(e){e.classList.add("popup_opened"),U.addEventListener("keydown",ee)}function I(e){e.classList.remove("popup_opened"),U.removeEventListener("keydown",ee)}function M(e){e&&(E.textContent="Сохранение...")}var F="",G=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},K=function(e){d.prepend(function(e){var t=s.cloneNode(!0);t.querySelector(".element__name").textContent=e.name,t.querySelector(".element__like_count").textContent=e.likes.length;var n=e._id,o=e.owner._id,r=e.likes,c=t.querySelector(".element__like-btn");o!==f.id&&t.querySelector(".element__dlt-btn").classList.add("element__dlt-btn_hidden"),t.querySelector(".element__dlt-btn").addEventListener("click",(function(){Q(n).then((function(){return t.remove()}))}));for(var i=r.length-1;i>=0;i--)r[i]!==f.id&&c.classList.add("element__like-btn_active");t.querySelector(".element__like-btn").addEventListener("click",(function(e){e.target.classList.contains("element__like-btn_active")?(e.target.classList.remove("element__like-btn_active"),V(n)):e.target.classList.add("element__like-btn_active")||R(n)}));var l=t.querySelector(".element__image");return l.src=e.link,l.alt="Изображение ".concat(e.name),l.addEventListener("click",(function(){p.src=e.link,p.alt="Изображение ".concat(e.name),_.textContent=e.name,H(m)})),console.log(n),console.log(r.length),t}(e))},Q=function(e){return fetch("".concat(z.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:z.headers,body:JSON.stringify({_id:""})}).then(G).catch((function(e){console.log(e)}))},R=function(e){return fetch("".concat(z.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:z.headers,body:JSON.stringify({_id:""})}).then(G).then((function(e){F=e.likes.length,console.log(F)})).catch((function(e){console.log(e)}))},V=function(e){return fetch("".concat(z.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:z.headers,body:JSON.stringify({_id:""})}).then(G).then((function(e){console.log(e.likes.length)})).catch((function(e){console.log(e)}))};fetch("".concat(z.baseUrl,"/cards"),{headers:z.headers}).then(G).then((function(e){for(var t=e.length-1;t>=0;t--)K(e[t])})).catch((function(e){console.log(e)})),fetch("".concat(z.baseUrl,"/users/me"),{headers:z.headers}).then(G).then((function(e){B.textContent=e.name,D.textContent=e.about,k.src=e.avatar,f.id=e._id})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){H(q),g.reset()})),P.addEventListener("click",(function(){I(q)}));var W=function(e){k.src=L.value,I(q)};g.addEventListener("submit",(function(e){e.preventDefault(),M(!0),fetch("".concat(z.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:z.headers,body:JSON.stringify({avatar:L.value})}).then((function(e){if(!e.ok)return Promise.reject("Ошибка ".concat(e.status))})).then((function(e){W(e)})).catch((function(e){console.log(e)})).finally((function(e){M(!1)}))})),x.addEventListener("click",(function(){H(y),h.reset()})),j.addEventListener("click",(function(){I(y)})),b.addEventListener("click",(function(){I(m)})),h.addEventListener("submit",(function(e){e.preventDefault(),T.value,w.value,M(!0),fetch("".concat(z.baseUrl,"/cards"),{method:"POST",headers:z.headers,body:JSON.stringify({name:T.value,link:w.value})}).then(G).then((function(e){K(e)})).catch((function(e){console.log(e)})).finally((function(e){M(!1)})),I(y)})),C.addEventListener("click",(function(){H(v),J.value=B.textContent,N.value=D.textContent})),O.addEventListener("click",(function(){I(v)}));var X,Y,Z,$=function(){B.textContent=J.value,D.textContent=N.value,I(v)};function ee(e){27===e.keyCode&&I(document.querySelector(".popup_opened"))}A.addEventListener("submit",(function(e){e.preventDefault,M(!0),fetch("".concat(z.baseUrl,"/users/me"),{method:"PATCH",headers:z.headers,body:JSON.stringify({name:J.value,about:N.value})}).then(G).then((function(e){$(e)})).catch((function(e){console.log(e)})).finally((function(e){M(!1)}))})),U.addEventListener("click",(function(e){e.target.classList.contains("popup_opened")&&I(document.querySelector(".popup_opened"))})),Y=(X={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__submit-btn",inactiveButtonClass:"form__submit-btn_disabled",inputErrorClass:"form__item_error",errorClass:"form__error"}).formSelector,Z=n(X,["formSelector"]),Array.from(document.querySelectorAll(Y)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,r){var c=r.inputSelector,l=r.submitButtonSelector,u=r.inactiveButtonClass,s=n(r,t),d=Array.from(e.querySelectorAll(c)),f=e.querySelector(l);e.addEventListener("reset",(function(){setTimeout((function(){a(f,u)}),0)})),d.forEach((function(t){t.addEventListener("input",(function(){o(e,t,s),i(d,f,u)}))}))}(e,Z)}))})();